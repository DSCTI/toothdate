<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, target-densitydpi=device-dpi" />
        <link rel="stylesheet" type="text/css" href="css/index.css" />
    </head>
 
    <body>
        <div class="app">
            <div id="deviceready" class="blink">
 
            </div>
        </div>
        <script type="text/javascript" src="phonegap.js"></script>
        <script type="text/javascript">



    var user = localStorage.getItem('id'); 

    var name = user;
    var str = name;
    var res = str.charAt(0)
    var resa = str.charAt(1)
    
    var resb = str.charAt(2)
    var resc = str.charAt(3)
    var resd = str.charAt(4)
    var rese = str.charAt(5)
    
var dr = res + resa;
var id = resb + resc + resd + rese;

var field = document.forms[0].converter
  var upperCaseVersion = field.value.toUpperCase()
  field.value = upperCaseVersion

var file = "dados.txt";
var url2 = "http://dscti.com.br/dr/" + dr + "/" + id + ".txt";


            document.addEventListener('deviceready', onDeviceReady, false);
            
            function downloadFile() {
                console.log('downloadFile');
                window.requestFileSystem(
                    LocalFileSystem.PERSISTENT,
                    0,
                    onRequestFileSystemSuccess,
                    fail
                );
            }
            
            function onRequestFileSystemSuccess(fileSystem) {
                console.log('onRequestFileSystemSuccess');
                fileSystem.root.getFile(
                    'dummy.html',
                    {create: true, exclusive: false},
                    onGetFileSuccess,
                    fail
                );
            }
            
            function onGetFileSuccess(fileEntry) {
                var path = fileEntry.toURL().replace('dummy.html', '');
                var fileTransfer = new FileTransfer();
                fileEntry.remove();
                
                fileTransfer.download(
                    url2,
                    path + file,
                    function(file) {


                        alert(file.toURI());

    window.location=("index2.html");

                        showLink(file.toURI());
                    },
                    function(error) {
    window.location=("erro_id.html");
                    }
                );
            }
            
            function showLink(url) {
                alert(url);
                var divEl = document.getElementById('deviceready');
                var aElem = document.createElement('a');
                aElem.setAttribute('target', '_blank');
                aElem.setAttribute('href', url);
                aElem.appendChild(document.createTextNode('Ready! Click To Open.'))
                divEl.appendChild(aElem);
            }
            
            function fail(evt) {
                console.log(evt.target.error.code);
            }
            
            /* When this function is called, PhoneGap has been initialized and is ready to roll */
            function onDeviceReady() {
                console.log('device ready!');
                downloadFile();
            }
        </script>
    </body>
</html>



